@model QuotationSystem.Models.Quotation.QuotationViewModel
@{
}
<div class="modal fade" id="quotationManagement" tabindex="-1" role="dialog" aria-labelledby="quotationModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable" role="document">
        <form class="modal-content" asp-controller="Quotation" asp-action="" method="post">
            <div class="modal-header">
                <h3 class="modal-title" id="exampleModalLongTitle">Quotation Management</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="d-flex flex-column">
                    <div>
                        <div class="row">
                            <div class="col-6">
                                <div class="d-flex flex-column" style="gap:1rem">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center" style="white-space: nowrap; gap: 1rem">
                                            <label class="m-0">Quotation No.:</label>
                                            <input class="form-control" type="text" id="textQuotationNo" readonly />
                                        </div>
                                        <div class="d-flex align-items-center" style="gap: 1rem">
                                            <label class="m-0">Date:</label>
                                            <input class="form-control" type="date" readonly />
                                        </div>
                                    </div>

                                    <div class="row align-items-center">
                                        <label class="m-0 col-2">Customer:</label>
                                        <input class="col form-control" id="textCusName" type="text" />
                                    </div>

                                    <div class="row align-items-center">
                                        <label class="m-0 col-2">Customer Address:</label>
                                        <textarea class="col form-control" id="textCusAddress"></textarea>
                                    </div>

                                    <div class="row align-items-center">
                                        <label class="m-0 col-2">Customer Contact:</label>
                                        <input class="col form-control" id="textCusContact" type="text" />
                                    </div>

                                    <div class="row align-items-center">
                                        <label class="m-0 col-2">Tax Id:</label>
                                        <input class="col form-control" id="textTaxId" type="text" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="d-flex flex-column" style="gap:1rem">
                                    <div class="row align-items-center text-nowrap">
                                        <label class="m-0 col-2">Sales Name:</label>
                                        <input class="col form-control" id="textSellerName" type="text" />
                                    </div>

                                    <div>
                                        <label class="m-0">Vat:</label>
                                        <input class="form-control" id="textVat" type="number" readonly placeholder="7%" />
                                    </div>

                                    <div>
                                        <label class="m-0" for="ActiveCheckbox">Active:</label>
                                        <input class="form-check" type="checkbox" checked id="activeCheckbox" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column">
                        <h5>Item List</h5>
                        <table class="table" id="item-table">
                            <thead>
                                <tr>
                                    <th scope="col">No</th>
                                    <th scope="col">Item Code</th>
                                    <th scope="col">Item Name</th>
                                    <th scope="col">Description</th>
                                    <th scope="col">Qty</th>
                                    <th scope="col">Unit</th>
                                    <th scope="col">Unit Price</th>
                                    <th scope="col">Discount</th>
                                    <th scope="col">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td><input class="form-control" type="text" id="textItemCode"/></td>
                                    <td><input class="form-control" type="text" id="textItemName"/></td>
                                    <td><input class="form-control" type="text" id="textDescription"/></td>
                                    <td><input class="form-control" type="text" id="textQty"/></td>
                                    <td><input class="form-control" type="text" id="textUnit"/></td>
                                    <td><input class="form-control" type="text" id="textUnitPrice"/></td>
                                    <td><input class="form-control" type="text" id="textDiscount"/></td>
                                    <td><input class="form-control" type="text" id="textTotal"/></td>
                                </tr>

                                <tr>
                                    <td>2</td>
                                    <td><input class="form-control" type="text" id="textItemCode" /></td>
                                    <td><input class="form-control" type="text" id="textItemName" /></td>
                                    <td><input class="form-control" type="text" id="textDescription" /></td>
                                    <td><input class="form-control" type="text" id="textQty" /></td>
                                    <td><input class="form-control" type="text" id="textUnit" /></td>
                                    <td><input class="form-control" type="text" id="textUnitPrice" /></td>
                                    <td><input class="form-control" type="text" id="textDiscount" /></td>
                                    <td><input class="form-control" type="text" id="textTotal" /></td>
                                </tr>

                                <tr><td><button type="button" id="btnAddRow">add row</button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="submit" id="saveBtn" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

@section Scripts{
    <script>
        function submitQuotationForm() {
            let itemList = new Array();
            $("#itemListTable").find("tr:gt(0)").each(() => {
                let itemCode = $(this).find("tr:eq(1)").val();
                let itemName = $(this).find("tr:eq(2)").val();
                let itemDesc = $(this).find("tr:eq(3)").val();
                let Qty = $(this).find("tr:eq(4)").val();
                let unitId = $(this).find("tr:eq(5)").val();
                let unitPrice = $(this).find("tr:eq(6)").val();
                let discount = $(this).find("tr:eq(7)").val();
                let total = $(this).find("tr:eq(8)").val();

                let quotationInfo = {
                    itemCode: itemCode,
                    itemName: itemName,
                    itemDesc: itemDesc,
                    Qty: Qty,
                    unitId: unitId,
                    unitPrice: unitPrice,
                    discount: discount,
                    total: total
                };
                itemList.push(quotationInfo);
                $.ajax({
                    url: '@Url.Action("")',
                    type: 'POST',
                    data: {
                        quotationNo: $('#textQuotationNo').val(),
                        customerName: $('#textCusName').val(),
                        customerAddress: $('#textCusAddress').val(),
                        customerContact: $('#textCusContact').val(),
                        taxId: $('#textTaxId').val(),
                        seller: $('#textSellerName').val(),
                        vat: $('#textVat').val(),
                        activeStatus: $('#activeCheckbox').val(),
                        itemList: JSON.stringify(itemList)
                    }
                })
            });
        }
    </script>

    <script>
        let lineNo = 4;
        $(document).ready(() => {
            $("#btnAddRow").click(() => {
                markup = `
                        <tr>
                            <td>${lineNo}</td>
                            <td><input class="form-control" type="text" /></td>
                            <td><input class="form-control" type="text" /></td>
                            <td><input class="form-control" type="text" /></td>
                            <td><input class="form-control" type="text" /></td>
                            <td><input class="form-control" type="text" /></td>
                            <td><input class="form-control" type="text" /></td>
                            <td><input class="form-control" type="text" /></td>
                            <td><input class="form-control" type="text" /></td>
                        </tr>`;
                console.log("button clicked");
                tableBody = $("#item-table tr:nth-last-child(2)");
                tableBody.after(markup);
                lineNo++;
            });
        });
    </script>
}